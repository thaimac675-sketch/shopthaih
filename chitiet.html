<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"><title>Chi Tiết</title>
    <style>
        body { font-family: sans-serif; padding: 15px; background: #f1f5f9; text-align: center; }
        .box { background: white; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; }
        .price { color: #e11d48; font-size: 24px; font-weight: bold; margin: 15px 0; }
        .btn-buy { width: 100%; padding: 15px; background: #22c55e; color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="box">
        <h2 id="t"></h2>
        <img id="i" style="width: 100%; border-radius: 10px;">
        <div class="price" id="p"></div>
        <div style="display: flex; justify-content: space-around; margin: 15px 0;">
            <div>Tướng: <b id="tg"></b></div>
            <div>Skin: <b id="sk"></b></div>
        </div>
        <button class="btn-buy" onclick="buy()">MUA NGAY</button>
        <p><a href="index.html">Quay lại</a></p>
    </div>

    <script>
        const acc = JSON.parse(localStorage.getItem("viewingAcc"));
        if(acc) {
            document.getElementById('t').innerText = acc.title;
            document.getElementById('i').src = acc.img;
            document.getElementById('p').innerText = parseInt(acc.price).toLocaleString() + "đ";
            document.getElementById('tg').innerText = acc.tuong;
            document.getElementById('sk').innerText = acc.skin;
        }

        function buy() {
            const user = localStorage.getItem("currentUser");
            if(!user) return alert("Vui lòng đăng nhập!");
            
            let balance = parseInt(localStorage.getItem("balance_" + user) || "0");
            let price = parseInt(acc.price);

            if (balance < price) {
                alert("❌ BẠN CẦN NẠP THÊM TIỀN ĐỂ MUA ACC NÀY!");
            } else {
                alert("✅ GIAO DỊCH THÀNH CÔNG! Hãy xem lịch sử để lấy TK/MK.");
                // Trừ tiền
                localStorage.setItem("balance_" + user, balance - price);
                // Lưu lịch sử
                let history = JSON.parse(localStorage.getItem("history_" + user) || "[]");
                history.push({ ...acc, buyTime: new Date().toLocaleString() });
                localStorage.setItem("history_" + user, JSON.stringify(history));
                // Xóa Acc khỏi shop
                let shopAccs = JSON.parse(localStorage.getItem("shop_accs") || "[]");
                shopAccs = shopAccs.filter(item => item.id != acc.id);
                localStorage.setItem("shop_accs", JSON.stringify(shopAccs));
                
                window.location.href = "lichsu.html";
            }
        }
    </script>
</body>
</html>
