<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop THAIPP</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; background: #f1f5f9; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: white; border-bottom: 2px solid #e11d48; }
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 10px; overflow: hidden; border: 1px solid #eee; }
        .card img { width: 100%; height: 120px; object-fit: cover; }
        .card-body { padding: 10px; }
        .price { color: #e11d48; font-weight: bold; margin: 5px 0; }
        .btn-view { width: 100%; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .filter-section { background: white; padding: 10px; display: flex; gap: 8px; overflow-x: auto; border-bottom: 1px solid #ddd; }
        .filter-btn { padding: 5px 12px; border-radius: 15px; border: 1px solid #ccc; background: #f8fafc; font-size: 12px; cursor: pointer; white-space: nowrap; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold; color:#e11d48;">★ SHOP THAIPP ★</div>
    <div id="userHeader">
        <a href="login.html" style="text-decoration:none; color:blue;">Đăng nhập</a> | 
        <a href="naptien.html" style="text-decoration:none; color:green;">Nạp tiền</a>
    </div>
</header>

<div class="filter-section">
    <button class="filter-btn" onclick="filterCat('all')">Tất cả</button>
    <button class="filter-btn" onclick="filterCat('50')">Dưới 50k</button>
    <button class="filter-btn" onclick="filterCat('150')">Dưới 150k</button>
    <button class="filter-btn" onclick="filterCat('500')">Dưới 500k</button>
    <button class="filter-btn" onclick="filterCat('2000')">Dưới 2M</button>
</div>

<main id="acc-container" class="grid-layout"></main>

<script>
    // --- ĐÃ CẬP NHẬT CONFIG TỪ VIDEO CỦA BẠN ---
    const firebaseConfig = {
        apiKey: "AIzaSyC75Af-i4AXLH6X...",
        authDomain: "shopthai-ea4c1.firebaseapp.com",
        databaseURL: "https://shopthai-ea4c1-default-rtdb.firebaseio.com",
        projectId: "shopthai-ea4c1",
        storageBucket: "shopthai-ea4c1.appspot.com",
        messagingSenderId: "114276793671",
        appId: "1:114276793671:web:0b257c70c675ef715f7d23"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. Tải Acc
    let allAccs = {};
    db.ref('shop_accs').on('value', (s) => {
        allAccs = s.val() || {};
        renderAccs('all');
    });

    function renderAccs(cat) {
        const container = document.getElementById('acc-container');
        container.innerHTML = "";
        for(let id in allAccs) {
            const acc = allAccs[id];
            if(cat !== 'all' && acc.cat !== cat) continue;
            container.innerHTML += `
                <div class="card">
                    <img src="${acc.img}" onerror="this.src='https://via.placeholder.com/150'">
                    <div class="card-body">
                        <h3 style="font-size:12px; margin:0;">${acc.title}</h3>
                        <div class="price">${parseInt(acc.price).toLocaleString()}đ</div>
                        <button class="btn-view" onclick="goDetail('${id}')">XEM CHI TIẾT</button>
                    </div>
                </div>`;
        }
    }

    function filterCat(c) { renderAccs(c); }

    // 2. Cập nhật Tiền User
    const currentUser = localStorage.getItem("currentUser");
    if(currentUser) {
        db.ref('users/' + currentUser).on('value', (s) => {
            const data = s.val();
            const bal = data ? (data.balance || 0) : 0;
            document.getElementById('userHeader').innerHTML = `
                <div style="text-align:right; font-size:12px;">
                    <b>${currentUser}</b> | <b style="color:green;">${bal.toLocaleString()}đ</b><br>
                    <a href="naptien.html" style="color:green;">[Nạp]</a> | <a href="#" onclick="localStorage.clear(); location.reload();">Thoát</a>
                </div>`;
        });
    }

    function goDetail(id) {
        localStorage.setItem("viewingAccId", id);
        window.location.href = "chitiet.html";
    }
</script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
<script src="script.js"></script>
</body>
</html>
