<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Li√™n Qu√¢n - THAIPP</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; background: #f1f5f9; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: white; border-bottom: 2px solid #e11d48; position: sticky; top: 0; z-index: 1000; }
        .logo { color: #e11d48; font-weight: bold; font-size: 18px; }
        
        /* B·ªô l·ªçc gi√° */
        .filter-section { background: white; padding: 10px; border-bottom: 1px solid #ddd; display: flex; gap: 8px; overflow-x: auto; }
        .filter-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; background: #f8fafc; cursor: pointer; font-weight: bold; white-space: nowrap; }
        .filter-btn.active { background: #e11d48; color: white; border-color: #e11d48; }

        /* Danh s√°ch Acc */
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 10px; overflow: hidden; border: 1px solid #eee; position: relative; }
        .card img { width: 100%; height: 120px; object-fit: cover; }
        .card-body { padding: 10px; }
        .price { color: #e11d48; font-weight: bold; font-size: 16px; margin: 5px 0; }
        .btn-view { width: 100%; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div class="logo">‚òÖ SHOP THAIPP ‚òÖ</div>
    <div id="userHeader">
        <a href="login.html" style="text-decoration:none; color:#2563eb;">ƒêƒÉng nh·∫≠p</a> | 
        <a href="naptien.html" style="text-decoration:none; color:#16a34a;">N·∫°p ti·ªÅn</a>
    </div>
</header>

<div class="filter-section">
    <button class="filter-btn active" onclick="filterPrice('all', this)">T·∫•t c·∫£</button>
    <button class="filter-btn" onclick="filterPrice('50', this)">D∆∞·ªõi 50k</button>
    <button class="filter-btn" onclick="filterPrice('150', this)">D∆∞·ªõi 150k</button>
    <button class="filter-btn" onclick="filterPrice('500', this)">D∆∞·ªõi 500k</button>
    <button class="filter-btn" onclick="filterPrice('2000', this)">D∆∞·ªõi 2M</button>
</div>

<main id="main-content">
    <section id="sec-2000"> <h2 style="padding:10px 15px; margin:0; font-size:16px;">‚òÖ ACC CAO C·∫§P 2M</h2> <div id="container-2000" class="grid-layout"></div> </section>
    <section id="sec-500"> <h2 style="padding:10px 15px; margin:0; font-size:16px;">‚òÖ ACC TRUNG C·∫§P 500K</h2> <div id="container-500" class="grid-layout"></div> </section>
    <section id="sec-150"> <h2 style="padding:10px 15px; margin:0; font-size:16px;">‚òÖ ACC GI√Å R·∫∫ 150K</h2> <div id="container-150" class="grid-layout"></div> </section>
    <section id="sec-50"> <h2 style="padding:10px 15px; margin:0; font-size:16px;">‚òÖ ACC S∆† C·∫§P 50K</h2> <div id="container-50" class="grid-layout"></div> </section>
</main>

<script>
    // 1. C·∫§U H√åNH FIREBASE (D√°n m√£ c·ªßa b·∫°n v√†o ƒë√¢y)
    const firebaseConfig = {
        apiKey: "AIzaSyC75Af-i4AXLH6...",
        databaseURL: "https://shopthai-ea4c1-default-rtdb.firebaseio.com",
        projectId: "shopthai-ea4c1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. C·∫¨P NH·∫¨T HEADER & TI·ªÄN
    function updateHeader() {
        const user = localStorage.getItem("currentUser");
        if (user) {
            db.ref('users/' + user).on('value', (s) => {
                const data = s.val() || { balance: 0 };
                document.getElementById('userHeader').innerHTML = `
                    <div style="text-align: right;">
                        <b style="font-size:13px;">üë§ ${user}</b> | <b style="color:#16a34a;">${data.balance.toLocaleString()}ƒë</b><br>
                        <a href="naptien.html" style="font-size:11px; color:#16a34a; font-weight:bold;">[N·∫°p th·∫ª]</a> | 
                        <a href="lichsu.html" style="font-size:11px; color:#2563eb; font-weight:bold;">[L·ªãch s·ª≠]</a> | 
                        <a href="#" onclick="logout()" style="font-size:11px; color:gray;">[Tho√°t]</a>
                    </div>`;
            });
        }
    }

    function logout() { localStorage.clear(); location.reload(); }

    // 3. T·∫¢I S·∫¢N PH·∫®M T·ª™ SERVER
    function loadProducts() {
        db.ref('shop_accs').on('value', (snapshot) => {
            const data = snapshot.val();
            const categories = ["50", "150", "500", "2000"];
            categories.forEach(id => document.getElementById("container-" + id).innerHTML = "");

            if (!data) return;

            for (let id in data) {
                const acc = data[id];
                const html = `
                    <div class="card">
                        <img src="${acc.img}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="card-body">
                            <h3 style="font-size:13px; margin:0;">${acc.title}</h3>
                            <div class="price">${parseInt(acc.price).toLocaleString()}ƒë</div>
                            <button class="btn-view" onclick="goDetail('${id}')">XEM CHI TI·∫æT</button>
                        </div>
                    </div>`;
                const target = document.getElementById("container-" + acc.cat);
                if (target) target.innerHTML += html;
            }
        });
    }

    // 4. B·ªò L·ªåC GI√Å
    function filterPrice(cat, btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const ids = ["50", "150", "500", "2000"];
        ids.forEach(id => {
            document.getElementById("sec-" + id).style.display = (cat === 'all' || cat === id) ? "block" : "none";
        });
    }

    function goDetail(id) {
        db.ref('shop_accs/' + id).once('value', (s) => {
            localStorage.setItem("viewingAcc", JSON.stringify(s.val()));
            window.location.href = "chitiet.html";
        });
    }

    window.onload = () => { updateHeader(); loadProducts(); };
</script>
</body>
</html>
