<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N·∫°p Th·∫ª C√†o - THAIPP</title>
    <style>
        body { font-family: sans-serif; background: #f1f5f9; padding: 15px; margin: 0; }
        .container { max-width: 450px; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #e11d48; text-align: center; margin-top: 0; }
        label { font-size: 13px; font-weight: bold; color: #475569; }
        input, select { width: 100%; padding: 12px; margin: 8px 0 15px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-send { width: 100%; padding: 15px; background: #e11d48; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .history { margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px; }
        .card-log { background: #f8fafc; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #e2e8f0; font-size: 13px; }
        .status-0 { color: orange; font-weight: bold; } /* Ch·ªù x·ª≠ l√Ω */
        .status-1 { color: green; font-weight: bold; }  /* Th√†nh c√¥ng */
        .status-2 { color: red; font-weight: bold; }    /* Th·∫•t b·∫°i */
    </style>
</head>
<body>

<div class="container">
    <h2>üí≥ N·∫†P TH·∫∫ C√ÄO</h2>
    
    <label>Lo·∫°i th·∫ª:</label>
    <select id="telco">
        <option value="VIETTEL">Viettel</option>
        <option value="VINAPHONE">Vinaphone</option>
        <option value="MOBIFONE">Mobifone</option>
    </select>

    <label>M·ªánh gi√°:</label>
    <select id="amount">
        <option value="10000">10,000ƒë</option>
        <option value="20000">20,000ƒë</option>
        <option value="50000">50,000ƒë</option>
        <option value="100000">100,000ƒë</option>
        <option value="200000">200,000ƒë</option>
        <option value="500000">500,000ƒë</option>
    </select>

    <label>S·ªë Serial:</label>
    <input type="text" id="serial" placeholder="Nh·∫≠p s·ªë serial tr√™n th·∫ª">

    <label>M√£ th·∫ª (PIN):</label>
    <input type="text" id="pin" placeholder="Nh·∫≠p m√£ th·∫ª sau l·ªõp c√†o">

    <button class="btn-send" onclick="handleSend()">G·ª¨I TH·∫∫ DUY·ªÜT</button>

    <div class="history">
        <h3 style="font-size:16px;">üìú L·ªäCH S·ª¨ N·∫†P TH·∫∫</h3>
        <div id="history-content"></div>
    </div>

    <p style="text-align:center; margin-top:20px;">
        <a href="index.html" style="text-decoration:none; color:#64748b; font-size:14px;">‚Üê Quay l·∫°i trang ch·ªß</a>
    </p>
</div>

<script>
    const currentUser = localStorage.getItem("currentUser");

    function handleSend() {
        if(!currentUser) {
            alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ n·∫°p th·∫ª!");
            window.location.href = "login.html";
            return;
        }

        const telco = document.getElementById('telco').value;
        const amount = document.getElementById('amount').value;
        const serial = document.getElementById('serial').value.trim();
        const pin = document.getElementById('pin').value.trim();

        if(!serial || !pin) {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Serial v√† M√£ th·∫ª!");
            return;
        }

        const cardData = {
            id: Date.now(),
            user: currentUser,
            telco: telco,
            amount: amount,
            serial: serial,
            pin: pin,
            status: 0, // 0: Ch·ªù x·ª≠ l√Ω, 1: Th√†nh c√¥ng, 2: Th·∫•t b·∫°i
            time: new Date().toLocaleString()
        };

        // L∆∞u v√†o danh s√°ch t·ªïng ƒë·ªÉ Admin th·∫•y
        let allCards = JSON.parse(localStorage.getItem("all_cards") || "[]");
        allCards.push(cardData);
        localStorage.setItem("all_cards", JSON.stringify(allCards));

        alert("G·ª≠i th·∫ª th√†nh c√¥ng! Vui l√≤ng ƒë·ª£i Admin ki·ªÉm tra.");
        location.reload();
    }

    function loadHistory() {
        if(!currentUser) {
            document.getElementById('history-content').innerHTML = "<p style='color:gray'>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠.</p>";
            return;
        }

        const allCards = JSON.parse(localStorage.getItem("all_cards") || "[]");
        const myCards = allCards.filter(c => c.user === currentUser);
        const container = document.getElementById('history-content');

        if(myCards.length === 0) {
            container.innerHTML = "<p style='color:gray'>B·∫°n ch∆∞a c√≥ y√™u c·∫ßu n·∫°p th·∫ª n√†o.</p>";
            return;
        }

        myCards.reverse().forEach(c => {
            let statusText = "";
            if(c.status === 0) statusText = '<span class="status-0">ƒêang ch·ªù duy·ªát...</span>';
            else if(c.status === 1) statusText = '<span class="status-1">Th√†nh c√¥ng ‚úÖ</span>';
            else statusText = '<span class="status-2">Th·∫ª l·ªói/Sai m√£ ‚ùå</span>';

            container.innerHTML += `
                <div class="card-log">
                    <b>${c.telco} - ${parseInt(c.amount).toLocaleString()}ƒë</b><br>
                    <small>${c.time}</small><br>
                    Tr·∫°ng th√°i: ${statusText}
                </div>`;
        });
    }

    window.onload = loadHistory;
</script>
</body>
</html>
