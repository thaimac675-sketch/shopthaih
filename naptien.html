<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N·∫°p Ti·ªÅn - SHOP THAIPP</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f1f5f9; margin: 0; padding: 15px; }
        .container { max-width: 450px; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #e11d48; text-align: center; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        label { font-size: 13px; font-weight: bold; color: #475569; display: block; margin-top: 15px; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 15px; }
        input:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        .btn-send { width: 100%; padding: 15px; background: #e11d48; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 16px; transition: 0.3s; }
        .btn-send:hover { background: #be123c; }
        .history-title { font-size: 16px; margin-top: 30px; padding-top: 15px; border-top: 1px solid #eee; font-weight: bold; color: #1e293b; }
        .card-log { background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #e2e8f0; font-size: 13px; }
        .status-0 { color: #f59e0b; font-weight: bold; }
        .status-1 { color: #16a34a; font-weight: bold; }
        .status-2 { color: #dc2626; font-weight: bold; }
        .back-btn { display: block; text-align: center; margin-top: 20px; color: #64748b; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üí≥ N·∫°p Th·∫ª C√†o</h2>
    
    <label>Lo·∫°i th·∫ª:</label>
    <select id="telco">
        <option value="VIETTEL">Viettel</option>
        <option value="VINAPHONE">Vinaphone</option>
        <option value="MOBIFONE">Mobifone</option>
        <option value="ZING">Th·∫ª Zing</option>
    </select>

    <label>M·ªánh gi√°:</label>
    <select id="amount">
        <option value="10000">10,000ƒë</option>
        <option value="20000">20,000ƒë</option>
        <option value="50000">50,000ƒë</option>
        <option value="100000">100,000ƒë</option>
        <option value="200000">200,000ƒë</option>
        <option value="500000">500,000ƒë</option>
    </select>

    <label>S·ªë Serial:</label>
    <input type="text" id="serial" placeholder="Nh·∫≠p m√£ serial">

    <label>M√£ th·∫ª (PIN):</label>
    <input type="text" id="pin" placeholder="Nh·∫≠p m√£ pin">

    <button class="btn-send" onclick="sendCard()">G·ª¨I TH·∫∫ DUY·ªÜT</button>

    <div class="history-title">üìú Tr·∫°ng th√°i th·∫ª v·ª´a g·ª≠i</div>
    <div id="card-history"></div>

    <a href="index.html" class="back-btn">‚Üê Quay l·∫°i c·ª≠a h√†ng</a>
</div>

<script>
    // Config Firebase t·ª´ shopthai-ea4c1
    const firebaseConfig = {
        apiKey: "AIzaSyC75Af-i4AXLH6X...",
        authDomain: "shopthai-ea4c1.firebaseapp.com",
        databaseURL: "https://shopthai-ea4c1-default-rtdb.firebaseio.com",
        projectId: "shopthai-ea4c1",
        storageBucket: "shopthai-ea4c1.appspot.com",
        messagingSenderId: "114276793671",
        appId: "1:114276793671:web:0b257c70c675ef715f7d23"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const user = localStorage.getItem("currentUser");

    function sendCard() {
        if(!user) return alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ n·∫°p th·∫ª!");
        const ser = document.getElementById('serial').value.trim();
        const pin = document.getElementById('pin').value.trim();
        if(!ser || !pin) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Serial v√† M√£ th·∫ª!");

        const id = Date.now();
        const data = {
            id: id, user: user,
            telco: document.getElementById('telco').value,
            amount: document.getElementById('amount').value,
            serial: ser, pin: pin,
            status: 0, time: new Date().toLocaleString()
        };
        db.ref('all_cards/' + id).set(data).then(() => {
            alert("ƒê√£ g·ª≠i th·∫ª th√†nh c√¥ng! Vui l√≤ng ch·ªù Admin duy·ªát.");
            document.getElementById('serial').value = "";
            document.getElementById('pin').value = "";
        });
    }

    if(user) {
        db.ref('all_cards').on('value', (s) => {
            const cards = s.val();
            const list = document.getElementById('card-history');
            list.innerHTML = "";
            let count = 0;
            for(let id in cards) {
                if(cards[id].user === user) {
                    count++;
                    let stText = cards[id].status == 0 ? '<span class="status-0">Ch·ªù duy·ªát</span>' : (cards[id].status == 1 ? '<span class="status-1">Th√†nh c√¥ng</span>' : '<span class="status-2">Th·∫ª l·ªói</span>');
                    list.innerHTML += `<div class="card-log">
                        <b>${cards[id].telco} - ${parseInt(cards[id].amount).toLocaleString()}ƒë</b><br>
                        <small>${cards[id].time}</small><br>Tr·∫°ng th√°i: ${stText}
                    </div>`;
                }
            }
            if(count == 0) list.innerHTML = "<p style='color:gray; font-size:12px;'>Ch∆∞a c√≥ l·ªãch s·ª≠ n·∫°p.</p>";
        });
    }
</script>
</body>
</html>
